<?xml version="1.0" encoding="UTF-8"?>
<project name="Automaton">
	<description>
		Automaton
	</description>
	<property name="base-dir" value="./"/>
	<property name="src" value="${basedir}/src"/>
	<property name="build-dir" value="${base-dir}/build"/>
	<property name="doc-dir" value="${base-dir}/resources/doc/javadoc/"/>
	<property name="jar-file" value="automaton.jar"/>
	<property name="gen-src" value="${base-dir}/resources/test/generated-src/"/>
	
	<path id="classpath">
		<pathelement path="${build-dir}"/>
		<fileset dir="${base-dir}/resources/lib">
			<include name="**/*.jar"/>
		</fileset>
	</path>	
	
	<path id="sourcepath">
		<pathelement path="${src}"/>
		<pathelement path="${gen-src}"/>
	</path>
	
	<target name="init">				
		<taskdef name="mopa" classname="hub.sam.mopa.MopaAntTask">
	        <classpath refid="classpath"/>
		</taskdef>
	</target>

	<target name="compile" depends="init, gen-models">
		<javac debug="on" destdir="${build-dir}" source="1.5" nowarn="yes">
			<src refid="sourcepath"/>
			<classpath refid="classpath"/>
		</javac>
	</target>
			
	<target name="doc" depends="compile">
		<javadoc windowtitle="Automaton" source="1.5" destdir="${doc-dir}">
			<fileset dir="${src}" defaultexcludes="yes">
				<include name="**/*.java" />
			</fileset>
		</javadoc>
	</target>

	<target name="clean">
		<delete dir="${build-dir}"/>
		<delete dir="${doc-dir}"/>
		<delete file="${jar-file}"/>
	</target>
			
	<target name="tests" depends="compile">
		<junit printsummary="true" haltonfailure="true" haltonerror="true" fork="on" maxmemory="200000000">			
			<formatter type="plain" usefile="no"/>			
    		<classpath refid="classpath"/>
			<test name="hub.sam.mof.test.Main"/>
		</junit>
	</target>
		
	
	<target name="gen-models" depends="init">
		<mkdir dir="${gen-src}"/>
		<taskdef name="mof" classname="hub.sam.mof.ant.GenerateCode" classpathref="classpath"/>
		<mof src="resources/models/test/automaton-ea.xml" destdir="${gen-src}" ea="true" library="true" libraryFile="resources/models/user/core.xml" force="true"/>
	</target>
</project>

